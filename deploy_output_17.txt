Found existing workflow: TVYcwBvRkHKWjhrC
Update Status: 200 {"updatedAt":"2026-02-19T13:41:21.013Z","createdAt":"2026-02-19T11:47:25.001Z","id":"TVYcwBvRkHKWjhrC","name":"Kreativ: AI Cognitive Router","description":null,"active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"ai-router","responseMode":"onReceived","options":{}},"id":"webhook-start","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[260,340],"webhookId":"kreativ-ai-router"},{"parameters":{"operation":"executeQuery","query":"={{ \"INSERT INTO debug_log (message) VALUES ('Router Start: \" + $json.body.phone + \"')\" }}"},"id":"log-start","name":"Log Start","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[480,340],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"operation":"executeQuery","query":"={{ \"INSERT INTO debug_log (message) VALUES ('Body Check: \" + $('Webhook').first().json.body.body + \"')\" }}"},"id":"log-debug","name":"Log Debug","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[700,340],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Webhook').first().json.body.body }}","operation":"contains","value2":"humano"},{"value1":"={{ $('Webhook').first().json.body.body }}","operation":"contains","value2":"suporte"},{"value1":"={{ $('Webhook').first().json.body.body }}","operation":"contains","value2":"atendente"}]},"combinator":"or"},"id":"if-regex","name":"Check Keywords","type":"n8n-nodes-base.if","typeVersion":1,"position":[920,340]},{"parameters":{"operation":"executeQuery","query":"INSERT INTO debug_log (message) VALUES ('Regex Match')"},"id":"log-regex","name":"Log Regex","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1140,340],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"operation":"executeQuery","query":"INSERT INTO debug_log (message) VALUES ('LLM Start')"},"id":"log-llm-start","name":"Log LLM Start","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1140,540],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"jsCode":"const body = $('Webhook').first().json.body.body;\nconst phone = $('Webhook').first().json.body.phone;\nconst lower = body.toLowerCase();\n\nlet action = 'reply';\nlet text = 'Olá! Sou a IA da Kreativ. Como posso ajudar?';\n\nif (lower.includes('humano') || lower.includes('suporte') || lower.includes('atendente') || lower.includes('urgente')) {\n  action = 'handover';\n  text = 'Entendi, você quer falar com um humano. Transferindo...';\n}\n\nreturn [{\n  json: {\n    action: action,\n    text: text,\n    original_phone: phone\n  }\n}];"},"id":"mock-llm","name":"Mock LLM (Execution)","type":"n8n-nodes-base.code","typeVersion":2,"position":[1360,540]},{"parameters":{"operation":"executeQuery","query":"={{ \"INSERT INTO debug_log (message) VALUES ('LLM Done. Action: \" + $('Mock LLM (Execution)').first().json.action + \"')\" }}"},"id":"log-llm-done","name":"Log LLM Done","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1580,540],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Mock LLM (Execution)').first().json.action }}","value2":"handover"}]}},"id":"if-handover","name":"If Handover","type":"n8n-nodes-base.if","typeVersion":1,"position":[1800,540]},{"parameters":{"operation":"executeQuery","query":"INSERT INTO debug_log (message) VALUES ('Handoff Start (Trigger Call)')"},"id":"log-handoff-start","name":"Log Handoff Start","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2020,640],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"method":"POST","url":"http://localhost:5678/webhook/request-human-support","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ phone: $('Webhook').first().json.body.phone, reason: 'Solicitado via IA (Mock v9)' }) }}"},"onError":"continueErrorOutput","id":"trigger-handoff","name":"Trigger Handoff","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2240,640]},{"parameters":{"operation":"executeQuery","query":"={{ \"INSERT INTO debug_log (message) VALUES ('Handoff Result: \" + ($json.error ? 'Error' : 'Success') + \"')\" }}"},"id":"log-handoff-res","name":"Log Handoff Result","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2460,640],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"method":"POST","url":"http://kreativ_builderbot:3008/api/send","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ phone: $('Webhook').first().json.body.phone, message: 'Transferindo para humano...' }) }}"},"id":"notify-handoff","name":"Notify User Handoff","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2680,640]}],"connections":{"Webhook":{"main":[[{"node":"Log Start","type":"main","index":0}]]},"Log Start":{"main":[[{"node":"Log Debug","type":"main","index":0}]]},"Log Debug":{"main":[[{"node":"Check Keywords","type":"main","index":0}]]},"Check Keywords":{"main":[[{"node":"Log Regex","type":"main","index":0}],[{"node":"Log LLM Start","type":"main","index":0}]]},"Log Regex":{"main":[[{"node":"Log Handoff Start","type":"main","index":0}]]},"Log LLM Start":{"main":[[{"node":"Mock LLM (Execution)","type":"main","index":0}]]},"Mock LLM (Execution)":{"main":[[{"node":"Log LLM Done","type":"main","index":0}]]},"Log LLM Done":{"main":[[{"node":"If Handover","type":"main","index":0}]]},"If Handover":{"main":[[{"node":"Log Handoff Start","type":"main","index":0}],[]]},"Log Handoff Start":{"main":[[{"node":"Trigger Handoff","type":"main","index":0}]]},"Trigger Handoff":{"main":[[{"node":"Log Handoff Result","type":"main","index":0}]]},"Log Handoff Result":{"main":[[{"node":"Notify User Handoff","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":null,"pinData":null,"versionId":"0cdd9a24-268f-44f9-b89b-85aa493e747b","activeVersionId":"0cdd9a24-268f-44f9-b89b-85aa493e747b","versionCounter":11,"triggerCount":1,"tags":[],"activeVersion":{"updatedAt":"2026-02-19T13:41:21.015Z","createdAt":"2026-02-19T13:41:21.015Z","versionId":"0cdd9a24-268f-44f9-b89b-85aa493e747b","workflowId":"TVYcwBvRkHKWjhrC","nodes":[{"parameters":{"httpMethod":"POST","path":"ai-router","responseMode":"onReceived","options":{}},"id":"webhook-start","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[260,340],"webhookId":"kreativ-ai-router"},{"parameters":{"operation":"executeQuery","query":"={{ \"INSERT INTO debug_log (message) VALUES ('Router Start: \" + $json.body.phone + \"')\" }}"},"id":"log-start","name":"Log Start","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[480,340],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"operation":"executeQuery","query":"={{ \"INSERT INTO debug_log (message) VALUES ('Body Check: \" + $('Webhook').first().json.body.body + \"')\" }}"},"id":"log-debug","name":"Log Debug","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[700,340],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Webhook').first().json.body.body }}","operation":"contains","value2":"humano"},{"value1":"={{ $('Webhook').first().json.body.body }}","operation":"contains","value2":"suporte"},{"value1":"={{ $('Webhook').first().json.body.body }}","operation":"contains","value2":"atendente"}]},"combinator":"or"},"id":"if-regex","name":"Check Keywords","type":"n8n-nodes-base.if","typeVersion":1,"position":[920,340]},{"parameters":{"operation":"executeQuery","query":"INSERT INTO debug_log (message) VALUES ('Regex Match')"},"id":"log-regex","name":"Log Regex","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1140,340],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"operation":"executeQuery","query":"INSERT INTO debug_log (message) VALUES ('LLM Start')"},"id":"log-llm-start","name":"Log LLM Start","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1140,540],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"jsCode":"const body = $('Webhook').first().json.body.body;\nconst phone = $('Webhook').first().json.body.phone;\nconst lower = body.toLowerCase();\n\nlet action = 'reply';\nlet text = 'Olá! Sou a IA da Kreativ. Como posso ajudar?';\n\nif (lower.includes('humano') || lower.includes('suporte') || lower.includes('atendente') || lower.includes('urgente')) {\n  action = 'handover';\n  text = 'Entendi, você quer falar com um humano. Transferindo...';\n}\n\nreturn [{\n  json: {\n    action: action,\n    text: text,\n    original_phone: phone\n  }\n}];"},"id":"mock-llm","name":"Mock LLM (Execution)","type":"n8n-nodes-base.code","typeVersion":2,"position":[1360,540]},{"parameters":{"operation":"executeQuery","query":"={{ \"INSERT INTO debug_log (message) VALUES ('LLM Done. Action: \" + $('Mock LLM (Execution)').first().json.action + \"')\" }}"},"id":"log-llm-done","name":"Log LLM Done","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1580,540],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"conditions":{"string":[{"value1":"={{ $('Mock LLM (Execution)').first().json.action }}","value2":"handover"}]}},"id":"if-handover","name":"If Handover","type":"n8n-nodes-base.if","typeVersion":1,"position":[1800,540]},{"parameters":{"operation":"executeQuery","query":"INSERT INTO debug_log (message) VALUES ('Handoff Start (Trigger Call)')"},"id":"log-handoff-start","name":"Log Handoff Start","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2020,640],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"method":"POST","url":"http://localhost:5678/webhook/request-human-support","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ phone: $('Webhook').first().json.body.phone, reason: 'Solicitado via IA (Mock v9)' }) }}"},"onError":"continueErrorOutput","id":"trigger-handoff","name":"Trigger Handoff","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2240,640]},{"parameters":{"operation":"executeQuery","query":"={{ \"INSERT INTO debug_log (message) VALUES ('Handoff Result: \" + ($json.error ? 'Error' : 'Success') + \"')\" }}"},"id":"log-handoff-res","name":"Log Handoff Result","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2460,640],"credentials":{"postgres":{"id":"lJaeEy4CpHbhgMAp","name":"Kreativ PostgreSQL"}}},{"parameters":{"method":"POST","url":"http://kreativ_builderbot:3008/api/send","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ phone: $('Webhook').first().json.body.phone, message: 'Transferindo para humano...' }) }}"},"id":"notify-handoff","name":"Notify User Handoff","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2680,640]}],"connections":{"Webhook":{"main":[[{"node":"Log Start","type":"main","index":0}]]},"Log Start":{"main":[[{"node":"Log Debug","type":"main","index":0}]]},"Log Debug":{"main":[[{"node":"Check Keywords","type":"main","index":0}]]},"Check Keywords":{"main":[[{"node":"Log Regex","type":"main","index":0}],[{"node":"Log LLM Start","type":"main","index":0}]]},"Log Regex":{"main":[[{"node":"Log Handoff Start","type":"main","index":0}]]},"Log LLM Start":{"main":[[{"node":"Mock LLM (Execution)","type":"main","index":0}]]},"Mock LLM (Execution)":{"main":[[{"node":"Log LLM Done","type":"main","index":0}]]},"Log LLM Done":{"main":[[{"node":"If Handover","type":"main","index":0}]]},"If Handover":{"main":[[{"node":"Log Handoff Start","type":"main","index":0}],[]]},"Log Handoff Start":{"main":[[{"node":"Trigger Handoff","type":"main","index":0}]]},"Trigger Handoff":{"main":[[{"node":"Log Handoff Result","type":"main","index":0}]]},"Log Handoff Result":{"main":[[{"node":"Notify User Handoff","type":"main","index":0}]]}},"authors":"Rafael da Silva","name":null,"description":null,"autosaved":false}}
