{"name": "Kreativ: Unified API Router (v1.1 - Fixed)", "nodes": [{"parameters": {"httpMethod": "POST", "path": "kreativ-unified-api", "responseMode": "responseNode", "options": {}}, "name": "Webhook API", "type": "n8n-nodes-base.webhook", "typeVersion": 2, "webhookId": "kreativ-unified-api-id"}, {"parameters": {"jsCode": "const body = .body || ;\nconst phone = String(body.phone || '').replace(/\\D/g, '');\nconst action = body.action || 'check_student';\nreturn [{ json: { ...body, phone, action } }];"}, "name": "Normalizar Input", "type": "n8n-nodes-base.code", "typeVersion": 2}, {"parameters": {"rules": {"values": [{"conditions": {"conditions": [{"leftValue": "={{ .action }}", "rightValue": "check_student", "operator": {"type": "string", "operation": "equals"}}]}}, {"conditions": {"conditions": [{"leftValue": "={{ .action }}", "rightValue": "request_human", "operator": {"type": "string", "operation": "equals"}}]}}, {"conditions": {"conditions": [{"leftValue": "={{ .action }}", "rightValue": "get_module", "operator": {"type": "string", "operation": "equals"}}]}}, {"conditions": {"conditions": [{"leftValue": "={{ .action }}", "rightValue": "get_progress", "operator": {"type": "string", "operation": "equals"}}]}}, {"conditions": {"conditions": [{"leftValue": "={{ .action }}", "rightValue": "submit_quiz", "operator": {"type": "string", "operation": "equals"}}]}}, {"conditions": {"conditions": [{"leftValue": "={{ .action }}", "rightValue": "ai_tutor", "operator": {"type": "string", "operation": "equals"}}]}}]}}, "name": "Roteador de A\u00e7\u00f5es", "type": "n8n-nodes-base.switch", "typeVersion": 3}, {"parameters": {"method": "POST", "url": "https://n8n.extensionista.site/webhook/kreativ-ai-tutor-v3", "sendBody": true, "specifyBody": "json", "jsonBody": "={{ { phone: .phone, body: .message || .body || \"Oi\" } }}", "options": {}}, "name": "AI Tutor: Proxy Request", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4.2}, {"parameters": {"respondWith": "json", "responseBody": "={{ JSON.stringify() }}"}, "name": "Responder Typebot", "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1}], "connections": {"Webhook API": {"main": [[{"node": "Normalizar Input", "type": "main", "index": 0}]]}, "Normalizar Input": {"main": [[{"node": "Roteador de A\u00e7\u00f5es", "type": "main", "index": 0}]]}, "Roteador de A\u00e7\u00f5es": {"main": [[], [], [], [], [], [{"node": "AI Tutor: Proxy Request", "type": "main", "index": 0}]]}, "AI Tutor: Proxy Request": {"main": [[{"node": "Responder Typebot", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}}