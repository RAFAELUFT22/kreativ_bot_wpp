{
    "updatedAt": "2026-02-22T03:31:51.990Z",
    "createdAt": "2026-02-19T19:55:15.163Z",
    "id": "mFwiM2dZyKeEgKk6",
    "name": "99-Global-Error-Handler",
    "description": null,
    "active": true,
    "isArchived": false,
    "nodes": [
        {
            "parameters": {},
            "id": "error-trigger",
            "name": "Error Trigger",
            "type": "n8n-nodes-base.errorTrigger",
            "typeVersion": 1,
            "position": [
                200,
                300
            ]
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://api.deepseek.com/chat/completions",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "Authorization",
                            "value": "Bearer sk-412552782fbe4009a25a013825e6ab66"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={{ JSON.stringify({\n  model: \"deepseek-chat\",\n  messages: [\n    { \n      role: \"system\", \n      content: \"Voc\u00ea \u00e9 o Arquiteto de Software Chefe do projeto Kreativ Educa\u00e7\u00e3o. Ocorreu uma falha cr\u00edtica em um dos fluxos do n8n. Escreva um prompt/roteiro de corre\u00e7\u00e3o estruturado e imperativo para ser executado por um agente de IA de terminal (Gemini CLI / Claude Code). FORMATA\u00c7\u00c3O: Responda APENAS com o texto em Markdown. Liste arquivos para ler e instru\u00e7\u00f5es de refatora\u00e7\u00e3o.\" \n    },\n    { \n      role: \"user\", \n      content: `DADOS DO ERRO:\\n- Workflow ID: ${$json.workflow.id}\\n- Workflow Name: ${$json.workflow.name}\\n- Mensagem de Erro: ${$json.execution.error.message}\\n- \u00daltimo N\u00f3 Executado: ${$json.execution.lastNodeExecuted}`\n    }\n  ],\n  temperature: 0.2\n}) }}",
                "options": {}
            },
            "id": "deepseek-fix",
            "name": "DeepSeek Gen Fix",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                400,
                300
            ]
        },
        {
            "parameters": {
                "jsCode": "const choices = $json.choices || [];\nconst fixPlan = choices[0]?.message?.content || 'Erro ao gerar plano.';\nreturn [{ json: { fixPlan } }];"
            },
            "id": "extract-fix",
            "name": "Extrair Plano",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                600,
                300
            ]
        },
        {
            "parameters": {
                "jsCode": "return [{ json: { ok: true } }];"
            },
            "id": "save-file",
            "name": "Salvar Ticket de Correcao",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                800,
                300
            ]
        },
        {
            "parameters": {
                "method": "POST",
                "url": "http://kreativ_builderbot:3008/api/send",
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={{ JSON.stringify({ phone: \"556399374165\", message: \"\ud83d\udea8 *FALHA CR\u00cdTICA DETECTADA*\\n\\nUm erro ocorreu no n8n. Um plano de corre\u00e7\u00e3o foi gerado em `auto-fix-plan.md`.\\n\\nExecute `bash scripts/auto-fix.sh` para aplicar a corre\u00e7\u00e3o.\" }) }}",
                "options": {}
            },
            "id": "notify-tutor",
            "name": "Notificar Tutor",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                1000,
                300
            ]
        }
    ],
    "connections": {
        "Error Trigger": {
            "main": [
                [
                    {
                        "node": "DeepSeek Gen Fix",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "DeepSeek Gen Fix": {
            "main": [
                [
                    {
                        "node": "Extrair Plano",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Extrair Plano": {
            "main": [
                [
                    {
                        "node": "Salvar Ticket de Corre\u00e7\u00e3o",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Salvar Ticket de Corre\u00e7\u00e3o": {
            "main": [
                [
                    {
                        "node": "Notificar Tutor",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {
        "executionOrder": "v1",
        "callerPolicy": "workflowsFromSameOwner",
        "availableInMCP": false
    },
    "staticData": null,
    "meta": null,
    "pinData": null,
    "versionId": "7f0aa079-0d15-4149-86f6-32567eda245d",
    "activeVersionId": "7f0aa079-0d15-4149-86f6-32567eda245d",
    "versionCounter": 6,
    "triggerCount": 0,
    "shared": [
        {
            "updatedAt": "2026-02-19T19:55:15.163Z",
            "createdAt": "2026-02-19T19:55:15.163Z",
            "role": "workflow:owner",
            "workflowId": "mFwiM2dZyKeEgKk6",
            "projectId": "q7Bjn5D4LxM4OjYW",
            "project": {
                "updatedAt": "2026-02-17T20:41:01.829Z",
                "createdAt": "2026-02-17T20:32:16.109Z",
                "id": "q7Bjn5D4LxM4OjYW",
                "name": "Rafael da Silva <rafael.luciano@mail.uft.edu.br>",
                "type": "personal",
                "icon": null,
                "description": null,
                "creatorId": "d7e6ecc8-7259-4124-87c7-29a5f2d233ba"
            }
        }
    ],
    "tags": [],
    "activeVersion": {
        "updatedAt": "2026-02-22T03:31:51.993Z",
        "createdAt": "2026-02-22T03:31:51.993Z",
        "versionId": "7f0aa079-0d15-4149-86f6-32567eda245d",
        "workflowId": "mFwiM2dZyKeEgKk6",
        "nodes": [
            {
                "parameters": {},
                "id": "error-trigger",
                "name": "Error Trigger",
                "type": "n8n-nodes-base.errorTrigger",
                "typeVersion": 1,
                "position": [
                    200,
                    300
                ]
            },
            {
                "parameters": {
                    "method": "POST",
                    "url": "https://api.deepseek.com/chat/completions",
                    "sendHeaders": true,
                    "headerParameters": {
                        "parameters": [
                            {
                                "name": "Authorization",
                                "value": "Bearer sk-412552782fbe4009a25a013825e6ab66"
                            }
                        ]
                    },
                    "sendBody": true,
                    "specifyBody": "json",
                    "jsonBody": "={{ JSON.stringify({\n  model: \"deepseek-chat\",\n  messages: [\n    { \n      role: \"system\", \n      content: \"Voc\u00ea \u00e9 o Arquiteto de Software Chefe do projeto Kreativ Educa\u00e7\u00e3o. Ocorreu uma falha cr\u00edtica em um dos fluxos do n8n. Escreva um prompt/roteiro de corre\u00e7\u00e3o estruturado e imperativo para ser executado por um agente de IA de terminal (Gemini CLI / Claude Code). FORMATA\u00c7\u00c3O: Responda APENAS com o texto em Markdown. Liste arquivos para ler e instru\u00e7\u00f5es de refatora\u00e7\u00e3o.\" \n    },\n    { \n      role: \"user\", \n      content: `DADOS DO ERRO:\\n- Workflow ID: ${$json.workflow.id}\\n- Workflow Name: ${$json.workflow.name}\\n- Mensagem de Erro: ${$json.execution.error.message}\\n- \u00daltimo N\u00f3 Executado: ${$json.execution.lastNodeExecuted}`\n    }\n  ],\n  temperature: 0.2\n}) }}",
                    "options": {}
                },
                "id": "deepseek-fix",
                "name": "DeepSeek Gen Fix",
                "type": "n8n-nodes-base.httpRequest",
                "typeVersion": 4.2,
                "position": [
                    400,
                    300
                ]
            },
            {
                "parameters": {
                    "jsCode": "const choices = $json.choices || [];\nconst fixPlan = choices[0]?.message?.content || 'Erro ao gerar plano.';\nreturn [{ json: { fixPlan } }];"
                },
                "id": "extract-fix",
                "name": "Extrair Plano",
                "type": "n8n-nodes-base.code",
                "typeVersion": 2,
                "position": [
                    600,
                    300
                ]
            },
            {
                "parameters": {
                    "jsCode": "return [{ json: { ok: true } }];"
                },
                "id": "save-file",
                "name": "Salvar Ticket de Correcao",
                "type": "n8n-nodes-base.code",
                "typeVersion": 2,
                "position": [
                    800,
                    300
                ]
            },
            {
                "parameters": {
                    "method": "POST",
                    "url": "http://kreativ_builderbot:3008/api/send",
                    "sendBody": true,
                    "specifyBody": "json",
                    "jsonBody": "={{ JSON.stringify({ phone: \"556399374165\", message: \"\ud83d\udea8 *FALHA CR\u00cdTICA DETECTADA*\\n\\nUm erro ocorreu no n8n. Um plano de corre\u00e7\u00e3o foi gerado em `auto-fix-plan.md`.\\n\\nExecute `bash scripts/auto-fix.sh` para aplicar a corre\u00e7\u00e3o.\" }) }}",
                    "options": {}
                },
                "id": "notify-tutor",
                "name": "Notificar Tutor",
                "type": "n8n-nodes-base.httpRequest",
                "typeVersion": 4.1,
                "position": [
                    1000,
                    300
                ]
            }
        ],
        "connections": {
            "Error Trigger": {
                "main": [
                    [
                        {
                            "node": "DeepSeek Gen Fix",
                            "type": "main",
                            "index": 0
                        }
                    ]
                ]
            },
            "DeepSeek Gen Fix": {
                "main": [
                    [
                        {
                            "node": "Extrair Plano",
                            "type": "main",
                            "index": 0
                        }
                    ]
                ]
            },
            "Extrair Plano": {
                "main": [
                    [
                        {
                            "node": "Salvar Ticket de Corre\u00e7\u00e3o",
                            "type": "main",
                            "index": 0
                        }
                    ]
                ]
            },
            "Salvar Ticket de Corre\u00e7\u00e3o": {
                "main": [
                    [
                        {
                            "node": "Notificar Tutor",
                            "type": "main",
                            "index": 0
                        }
                    ]
                ]
            }
        },
        "authors": "Rafael da Silva",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
            {
                "createdAt": "2026-02-22T03:33:20.491Z",
                "id": 1533,
                "workflowId": "mFwiM2dZyKeEgKk6",
                "versionId": "7f0aa079-0d15-4149-86f6-32567eda245d",
                "event": "activated",
                "userId": "d7e6ecc8-7259-4124-87c7-29a5f2d233ba"
            }
        ]
    }
}
